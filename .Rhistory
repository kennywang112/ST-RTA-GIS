)
hotspot_data <- edt[[1]]
non_hotspot_data <- edt[[2]]
n_hot <- nrow(hotspot_data)
n_non <- nrow(non_hotspot_data)
target_size <- min(n_hot, n_non)
print(paste("Balancing data to size:", target_size))
fdt <- bind_rows(
hotspot_data %>% sample_n(target_size) %>% mutate(type = 1),
non_hotspot_data %>% sample_n(target_size) %>% mutate(type = 0)
) %>%
select(-bn_feature, -grid_filter, -hotspot, -any_of(cols_to_remove))
model <- glm(type ~ ., data = fdt, family = binomial)
summary(model)
model <- glm(type ~ ., data = fdt, family = binomial)
summary(model)
probabilities <- predict(model, newdata = fdt, type = "response")
predicted_classes <- ifelse(probabilities > 0.5, 1, 0)
cm <- confusionMatrix(factor(predicted_classes, levels = c(0, 1)),
factor(fdt$type, levels = c(0, 1)))
acc_value <- cm$overall['Accuracy']
print(cm)
imp <- varImp(model)
imp_df <- data.frame(
Variable = rownames(imp),
Importance = imp$Overall
)
coefs <- coef(model)
match_idx <- match(imp_df$Variable, names(coefs))
imp_df$Coefficient <- coefs[match_idx]
imp_df$Direction <- ifelse(imp_df$Coefficient > 0, "Hotspot", "Non-Hotspot")
# 排序整理
imp_df <- imp_df[order(imp_df$Importance, decreasing = FALSE), ]
imp_df$Variable <- factor(imp_df$Variable, levels = imp_df$Variable)
odds_ratios <- exp(coef(model))
imp_df$OddsRatio <- odds_ratios[as.character(imp_df$Variable)]
print(head(imp_df))
imp_df %>%
filter(Importance > 1.96) %>% # 這裡的閾值可根據 t-statistic 或需求調整
ggplot(aes(x = Importance, y = Variable, color = Direction)) +
geom_segment(aes(x = 0, xend = Importance, y = Variable, yend = Variable), linewidth = 1) +
geom_point(size = 4) +
# 設定顏色：紅色為熱點，藍色為非熱點
scale_color_manual(values = c("Hotspot" = "#E41A1C", "Non-Hotspot" = "#377EB8")) +
theme_minimal(base_family = "PingFang TC") +
labs(title = "Variable Importance: Hotspot vs Non-Hotspot",
x = "Variable Importance (Absolute t-value)",
y = "Variables")
imp_df %>%
filter(Importance > 1.96) %>%
ggplot(aes(x = OddsRatio, y = Variable, color = Direction)) +
# 基準線設為 1 (OR=1 代表無影響)
geom_vline(xintercept = 1, linetype = "dashed", color = "gray") +
geom_segment(aes(x = 1, xend = OddsRatio, y = Variable, yend = Variable), linewidth = 1) +
geom_point(size = 4) +
scale_color_manual(values = c("Hotspot" = "#E41A1C", "Non-Hotspot" = "#377EB8")) +
theme_minimal(base_family = "PingFang TC") +
labs(title = "Odds Ratio: Predictors of Hotspots",
x = "Odds Ratio ( >1 favors Hotspot )",
y = "Variables")
imp_df %>%
filter(Importance > 1.96)
imp_df %>%
filter(Importance > 1.96 & Variable != parkinglot_100m_count_mean) %>%
ggplot(aes(x = OddsRatio, y = Variable, color = Direction)) +
geom_vline(xintercept = 1, linetype = "dashed", color = "gray") +
geom_segment(aes(x = 1, xend = OddsRatio, y = Variable, yend = Variable), linewidth = 1) +
geom_point(size = 4) +
scale_color_manual(values = c("Hotspot" = "#E41A1C", "Non-Hotspot" = "#377EB8")) +
theme_minimal(base_family = "PingFang TC") +
labs(title = "Odds Ratio: Predictors of Hotspots",
x = "Odds Ratio ( >1 favors Hotspot )",
y = "Variables")
imp_df %>%
filter(Importance > 1.96 & (Variable != parkinglot_100m_count_mean)) %>%
ggplot(aes(x = OddsRatio, y = Variable, color = Direction)) +
geom_vline(xintercept = 1, linetype = "dashed", color = "gray") +
geom_segment(aes(x = 1, xend = OddsRatio, y = Variable, yend = Variable), linewidth = 1) +
geom_point(size = 4) +
scale_color_manual(values = c("Hotspot" = "#E41A1C", "Non-Hotspot" = "#377EB8")) +
theme_minimal(base_family = "PingFang TC") +
labs(title = "Odds Ratio: Predictors of Hotspots",
x = "Odds Ratio ( >1 favors Hotspot )",
y = "Variables")
imp_df %>%
filter(Importance > 1.96 & Variable != parkinglot_100m_count_mean) %>%
ggplot(aes(x = OddsRatio, y = Variable, color = Direction)) +
geom_vline(xintercept = 1, linetype = "dashed", color = "gray") +
geom_segment(aes(x = 1, xend = OddsRatio, y = Variable, yend = Variable), linewidth = 1) +
geom_point(size = 4) +
scale_color_manual(values = c("Hotspot" = "#E41A1C", "Non-Hotspot" = "#377EB8")) +
theme_minimal(base_family = "PingFang TC") +
labs(title = "Odds Ratio: Predictors of Hotspots",
x = "Odds Ratio ( >1 favors Hotspot )",
y = "Variables")
imp_df %>%
filter((Importance > 1.96) & (Variable != parkinglot_100m_count_mea)n) %>%
imp_df %>%
filter((Importance > 1.96) | (Variable != parkinglot_100m_count_mean)) %>%
ggplot(aes(x = OddsRatio, y = Variable, color = Direction)) +
geom_vline(xintercept = 1, linetype = "dashed", color = "gray") +
geom_segment(aes(x = 1, xend = OddsRatio, y = Variable, yend = Variable), linewidth = 1) +
geom_point(size = 4) +
scale_color_manual(values = c("Hotspot" = "#E41A1C", "Non-Hotspot" = "#377EB8")) +
theme_minimal(base_family = "PingFang TC") +
labs(title = "Odds Ratio: Predictors of Hotspots",
x = "Odds Ratio ( >1 favors Hotspot )",
y = "Variables")
imp_df %>%
filter((Importance > 1.96) || (Variable != parkinglot_100m_count_mean)) %>%
ggplot(aes(x = OddsRatio, y = Variable, color = Direction)) +
geom_vline(xintercept = 1, linetype = "dashed", color = "gray") +
geom_segment(aes(x = 1, xend = OddsRatio, y = Variable, yend = Variable), linewidth = 1) +
geom_point(size = 4) +
scale_color_manual(values = c("Hotspot" = "#E41A1C", "Non-Hotspot" = "#377EB8")) +
theme_minimal(base_family = "PingFang TC") +
labs(title = "Odds Ratio: Predictors of Hotspots",
x = "Odds Ratio ( >1 favors Hotspot )",
y = "Variables")
imp_df %>%
filter(Importance > 1.96) %>%
ggplot(aes(x = OddsRatio, y = Variable, color = Direction)) +
geom_vline(xintercept = 1, linetype = "dashed", color = "gray") +
geom_segment(aes(x = 1, xend = OddsRatio, y = Variable, yend = Variable), linewidth = 1) +
geom_point(size = 4) +
scale_color_manual(values = c("Hotspot" = "#E41A1C", "Non-Hotspot" = "#377EB8")) +
theme_minimal(base_family = "PingFang TC") +
labs(title = "Odds Ratio: Predictors of Hotspots",
x = "Odds Ratio ( >1 favors Hotspot )",
y = "Variables")
imp_df %>%
filter(Importance > 1.96)
imp_df %>%
filter(Importance > 1.96 & OddsRatio < 100) %>%
ggplot(aes(x = OddsRatio, y = Variable, color = Direction)) +
geom_vline(xintercept = 1, linetype = "dashed", color = "gray") +
geom_segment(aes(x = 1, xend = OddsRatio, y = Variable, yend = Variable), linewidth = 1) +
geom_point(size = 4) +
scale_color_manual(values = c("Hotspot" = "#E41A1C", "Non-Hotspot" = "#377EB8")) +
theme_minimal(base_family = "PingFang TC") +
labs(title = "Odds Ratio: Predictors of Hotspots",
x = "Odds Ratio ( >1 favors Hotspot )",
y = "Variables")
fdt <- bind_rows(
hotspot_data %>% sample_n(target_size) %>% mutate(type = 1),
non_hotspot_data %>% sample_n(target_size) %>% mutate(type = 0)
) %>%
select(-bn_feature, -grid_filter, -hotspot, -all_of(cols_to_remove))
model <- glm(type ~ ., data = fdt, family = binomial)
summary(model)
probabilities <- predict(model, newdata = fdt, type = "response")
predicted_classes <- ifelse(probabilities > 0.5, 1, 0)
cm <- confusionMatrix(factor(predicted_classes, levels = c(0, 1)),
factor(fdt$type, levels = c(0, 1)))
acc_value <- cm$overall['Accuracy']
print(cm)
imp <- varImp(model)
imp_df <- data.frame(
Variable = rownames(imp),
Importance = imp$Overall
)
coefs <- coef(model)
match_idx <- match(imp_df$Variable, names(coefs))
imp_df$Coefficient <- coefs[match_idx]
imp_df$Direction <- ifelse(imp_df$Coefficient > 0, "Hotspot", "Non-Hotspot")
imp_df <- imp_df[order(imp_df$Importance, decreasing = FALSE), ]
imp_df$Variable <- factor(imp_df$Variable, levels = imp_df$Variable)
odds_ratios <- exp(coef(model))
imp_df$OddsRatio <- odds_ratios[as.character(imp_df$Variable)]
print(head(imp_df))
imp_df %>%
filter(Importance > 1.96) %>% # 這裡的閾值可根據 t-statistic 或需求調整
ggplot(aes(x = Importance, y = Variable, color = Direction)) +
geom_segment(aes(x = 0, xend = Importance, y = Variable, yend = Variable), linewidth = 1) +
geom_point(size = 4) +
# 設定顏色：紅色為熱點，藍色為非熱點
scale_color_manual(values = c("Hotspot" = "#E41A1C", "Non-Hotspot" = "#377EB8")) +
theme_minimal(base_family = "PingFang TC") +
labs(title = "Variable Importance: Hotspot vs Non-Hotspot",
x = "Variable Importance (Absolute t-value)",
y = "Variables")
imp_df %>%
filter(Importance > 1.96 & OddsRatio < 100) %>%
ggplot(aes(x = OddsRatio, y = Variable, color = Direction)) +
geom_vline(xintercept = 1, linetype = "dashed", color = "gray") +
geom_segment(aes(x = 1, xend = OddsRatio, y = Variable, yend = Variable), linewidth = 1) +
geom_point(size = 4) +
scale_color_manual(values = c("Hotspot" = "#E41A1C", "Non-Hotspot" = "#377EB8")) +
theme_minimal(base_family = "PingFang TC") +
labs(title = "Odds Ratio: Predictors of Hotspots",
x = "Odds Ratio ( >1 favors Hotspot )",
y = "Variables")
all_features
all_features$no_lane
View(fdt)
fdt <- bind_rows(
hotspot_data %>% sample_n(target_size) %>% mutate(type = 1),
non_hotspot_data %>% sample_n(target_size) %>% mutate(type = 0)
) %>%
select(-bn_feature, -grid_filter, -hotspot, -all_of(cols_to_remove), -no_lane)
model <- glm(type ~ ., data = fdt, family = binomial)
summary(model)
probabilities <- predict(model, newdata = fdt, type = "response")
predicted_classes <- ifelse(probabilities > 0.5, 1, 0)
cm <- confusionMatrix(factor(predicted_classes, levels = c(0, 1)),
factor(fdt$type, levels = c(0, 1)))
acc_value <- cm$overall['Accuracy']
print(cm)
imp <- varImp(model)
imp_df <- data.frame(
Variable = rownames(imp),
Importance = imp$Overall
)
coefs <- coef(model)
match_idx <- match(imp_df$Variable, names(coefs))
imp_df$Coefficient <- coefs[match_idx]
imp_df$Direction <- ifelse(imp_df$Coefficient > 0, "Hotspot", "Non-Hotspot")
imp_df <- imp_df[order(imp_df$Importance, decreasing = FALSE), ]
imp_df$Variable <- factor(imp_df$Variable, levels = imp_df$Variable)
odds_ratios <- exp(coef(model))
imp_df$OddsRatio <- odds_ratios[as.character(imp_df$Variable)]
print(head(imp_df))
imp_df %>%
filter(Importance > 1.96) %>% # 這裡的閾值可根據 t-statistic 或需求調整
ggplot(aes(x = Importance, y = Variable, color = Direction)) +
geom_segment(aes(x = 0, xend = Importance, y = Variable, yend = Variable), linewidth = 1) +
geom_point(size = 4) +
# 設定顏色：紅色為熱點，藍色為非熱點
scale_color_manual(values = c("Hotspot" = "#E41A1C", "Non-Hotspot" = "#377EB8")) +
theme_minimal(base_family = "PingFang TC") +
labs(title = "Variable Importance: Hotspot vs Non-Hotspot",
x = "Variable Importance (Absolute t-value)",
y = "Variables")
imp_df %>%
filter(Importance > 1.96 & OddsRatio < 100) %>%
ggplot(aes(x = OddsRatio, y = Variable, color = Direction)) +
geom_vline(xintercept = 1, linetype = "dashed", color = "gray") +
geom_segment(aes(x = 1, xend = OddsRatio, y = Variable, yend = Variable), linewidth = 1) +
geom_point(size = 4) +
scale_color_manual(values = c("Hotspot" = "#E41A1C", "Non-Hotspot" = "#377EB8")) +
theme_minimal(base_family = "PingFang TC") +
labs(title = "Odds Ratio: Predictors of Hotspots",
x = "Odds Ratio ( >1 favors Hotspot )",
y = "Variables")
imp_df %>%
filter(Importance > 1.96 & OddsRatio < 100) %>%
ggplot(aes(x = OddsRatio, y = Variable, color = Direction)) +
geom_vline(xintercept = 1, linetype = "dashed", color = "gray") +
geom_segment(aes(x = 1, xend = OddsRatio, y = Variable, yend = Variable), linewidth = 1) +
geom_point(size = 4) +
scale_color_manual(values = c("Hotspot" = "#E41A1C", "Non-Hotspot" = "#377EB8")) +
theme_minimal(base_family = "PingFang TC") +
labs(title = "Odds Ratio"),
imp_df %>%
filter(Importance > 1.96 & OddsRatio < 100) %>%
ggplot(aes(x = OddsRatio, y = Variable, color = Direction)) +
geom_vline(xintercept = 1, linetype = "dashed", color = "gray") +
geom_segment(aes(x = 1, xend = OddsRatio, y = Variable, yend = Variable), linewidth = 1) +
geom_point(size = 4) +
scale_color_manual(values = c("Hotspot" = "#E41A1C", "Non-Hotspot" = "#377EB8")) +
theme_minimal(base_family = "PingFang TC") +
labs(title = "Odds Ratio",
x = "Odds Ratio",
y = "Variables")
imp_df %>%
filter(Importance > 1.96) %>% # 這裡的閾值可根據 t-statistic 或需求調整
ggplot(aes(x = Importance, y = Variable, color = Direction)) +
geom_segment(aes(x = 0, xend = Importance, y = Variable, yend = Variable), linewidth = 1) +
geom_point(size = 4) +
# 設定顏色：紅色為熱點，藍色為非熱點
scale_color_manual(values = c("Hotspot" = "#E41A1C", "Non-Hotspot" = "#377EB8")) +
theme_minimal(base_family = "PingFang TC") +
labs(title = "Variable Importance: Hotspot vs Non-Hotspot",
x = "Variable Importance (Absolute t-value)",
y = "Variables")
imp_df %>%
filter(Importance > 1.96) %>% # 這裡的閾值可根據 t-statistic 或需求調整
ggplot(aes(x = Importance, y = Variable, color = Direction)) +
geom_segment(aes(x = 0, xend = Importance, y = Variable, yend = Variable), linewidth = 1) +
geom_point(size = 4) +
# 設定顏色：紅色為熱點，藍色為非熱點
scale_color_manual(values = c("Hotspot" = "#E41A1C", "Non-Hotspot" = "#377EB8")) +
theme_minimal(base_family = "PingFang TC") +
labs(title = "Variable Importance",
x = "Variable Importance",
y = "Variables")
imp_df %>%
filter(Importance > 1.96 & OddsRatio < 100) %>%
ggplot(aes(x = OddsRatio, y = Variable, color = Direction)) +
geom_vline(xintercept = 1, linetype = "dashed", color = "gray") +
geom_segment(aes(x = 1, xend = OddsRatio, y = Variable, yend = Variable), linewidth = 1) +
geom_point(size = 4) +
scale_color_manual(values = c("Hotspot" = "#E41A1C", "Non-Hotspot" = "#377EB8")) +
theme_minimal(base_family = "PingFang TC") +
labs(title = "Odds Ratio",
x = "Odds Ratio",
y = "Variables")
imp_df %>%
# filter(Importance > 1.96 & OddsRatio < 100) %>%
filter(Importance > 1.96) %>%
ggplot(aes(x = OddsRatio, y = Variable, color = Direction)) +
geom_vline(xintercept = 1, linetype = "dashed", color = "gray") +
geom_segment(aes(x = 1, xend = OddsRatio, y = Variable, yend = Variable), linewidth = 1) +
geom_point(size = 4) +
scale_color_manual(values = c("Hotspot" = "#E41A1C", "Non-Hotspot" = "#377EB8")) +
theme_minimal(base_family = "PingFang TC") +
labs(title = "Odds Ratio",
x = "Odds Ratio",
y = "Variables")
imp_df %>%
filter(Importance > 1.96) %>% # 這裡的閾值可根據 t-statistic 或需求調整
ggplot(aes(x = Importance, y = Variable, color = Direction)) +
geom_segment(aes(x = 0, xend = Importance, y = Variable, yend = Variable), linewidth = 1) +
geom_point(size = 4) +
# 設定顏色：紅色為熱點，藍色為非熱點
scale_color_manual(values = c("Hotspot" = "#E41A1C", "Non-Hotspot" = "#377EB8")) +
theme_minimal(base_family = "PingFang TC") +
labs(title = "Variable Importance",
x = "Variable Importance",
y = "Variables")
imp_df %>%
# filter(Importance > 1.96 & OddsRatio < 100) %>%
filter(Importance > 1.96) %>%
ggplot(aes(x = OddsRatio, y = Variable, color = Direction)) +
geom_vline(xintercept = 1, linetype = "dashed", color = "gray") +
geom_segment(aes(x = 1, xend = OddsRatio, y = Variable, yend = Variable), linewidth = 1) +
geom_point(size = 4) +
scale_color_manual(values = c("Hotspot" = "#E41A1C", "Non-Hotspot" = "#377EB8")) +
theme_minimal(base_family = "PingFang TC") +
labs(title = "Odds Ratio",
x = "Odds Ratio",
y = "Variables")
export_data <- list(
adjacency = Mapper$adjacency,
num_vertices = Mapper$num_vertices,
level_of_vertex = Mapper$level_of_vertex,
points_in_vertex = Mapper$points_in_vertex,
original_data = as.data.frame(all_features),
# this is the label that already calculated for each node
cc = tibble(
eigen_centrality = e_scores,
betweenness = b_scores,
weighted_betweenness = b_scores_weighted,
weighted_eigen_centrality = e_scores_weighted,
eigen_top10 = e_labels,
betweenness_top10 = b_labels,
threshold_hotspot = features$hotspott
)
)
write(toJSON(export_data, auto_unbox = TRUE), "~/desktop/my_mapper_graph.json")
# This is for hotspot
get_hotspot_data <- function(features) {
hotspot_features <- features %>% filter(hotspot > 0.2)
unique_indices <- unique(unlist(hotspot_features$points_in_vertex))
hotspot_grid_data <- all_features_grid[unique_indices, ]
non_hotspot_grid_data <- all_features_grid[-unique_indices, ]
return(list(hotspot_grid_data, non_hotspot_grid_data))
}
edt <- get_hotspot_data(filter_features)
edt
node_hotspot_values <- vapply(Mapper$points_in_vertex, function(idx) {
mean(all_features$hotspot[idx], na.rm = TRUE)
}, numeric(1))
features$hotspot <- node_hotspot_values
features <- features%>%
mutate(hotspott = ifelse(hotspot > 0.2, 1, 0))
MapperPlotterV2(
Mapper,
# label = e_scores,
label = features$hotspott,
# label = b_labels,
# label = b_scores,
data = filter_data,
is_node_attribute = TRUE
)
library(jsonlite)
export_data <- list(
adjacency = Mapper$adjacency,
num_vertices = Mapper$num_vertices,
level_of_vertex = Mapper$level_of_vertex,
points_in_vertex = Mapper$points_in_vertex,
original_data = as.data.frame(all_features),
# this is the label that already calculated for each node
cc = tibble(
eigen_centrality = e_scores,
betweenness = b_scores,
weighted_betweenness = b_scores_weighted,
weighted_eigen_centrality = e_scores_weighted,
eigen_top10 = e_labels,
betweenness_top10 = b_labels,
threshold_hotspot = features$hotspott
)
)
write(toJSON(export_data, auto_unbox = TRUE), "~/desktop/my_mapper_graph.json")
# This is for hotspot
get_hotspot_data <- function(features) {
hotspot_features <- features %>% filter(hotspot > 0.2)
unique_indices <- unique(unlist(hotspot_features$points_in_vertex))
hotspot_grid_data <- all_features_grid[unique_indices, ]
non_hotspot_grid_data <- all_features_grid[-unique_indices, ]
return(list(hotspot_grid_data, non_hotspot_grid_data))
}
edt <- get_hotspot_data(filter_features)
edt
hotspot_data <- edt[[1]]
non_hotspot_data <- edt[[2]]
n_hot <- nrow(hotspot_data)
n_non <- nrow(non_hotspot_data)
target_size <- min(n_hot, n_non)
fdt <- bind_rows(
hotspot_data %>% sample_n(target_size) %>% mutate(type = 1),
non_hotspot_data %>% sample_n(target_size) %>% mutate(type = 0)
) %>%
select(-bn_feature, -grid_filter, -hotspot, -all_of(cols_to_remove), -no_lane)
model <- glm(type ~ ., data = fdt, family = binomial)
summary(model)
probabilities <- predict(model, newdata = fdt, type = "response")
predicted_classes <- ifelse(probabilities > 0.5, 1, 0)
cm <- confusionMatrix(factor(predicted_classes, levels = c(0, 1)),
factor(fdt$type, levels = c(0, 1)))
acc_value <- cm$overall['Accuracy']
print(cm)
imp <- varImp(model)
imp_df <- data.frame(
Variable = rownames(imp),
Importance = imp$Overall
)
coefs <- coef(model)
match_idx <- match(imp_df$Variable, names(coefs))
imp_df$Coefficient <- coefs[match_idx]
imp_df$Direction <- ifelse(imp_df$Coefficient > 0, "Hotspot", "Non-Hotspot")
imp_df <- imp_df[order(imp_df$Importance, decreasing = FALSE), ]
imp_df$Variable <- factor(imp_df$Variable, levels = imp_df$Variable)
odds_ratios <- exp(coef(model))
imp_df$OddsRatio <- odds_ratios[as.character(imp_df$Variable)]
print(head(imp_df))
imp_df %>%
filter(Importance > 1.96) %>%
ggplot(aes(x = Importance, y = Variable, color = Direction)) +
geom_segment(aes(x = 0, xend = Importance, y = Variable, yend = Variable), linewidth = 1) +
geom_point(size = 4) +
# 設定顏色：紅色為熱點，藍色為非熱點
scale_color_manual(values = c("Hotspot" = "#E41A1C", "Non-Hotspot" = "#377EB8")) +
theme_minimal(base_family = "PingFang TC") +
labs(title = "Variable Importance",
x = "Variable Importance",
y = "Variables")
imp_df %>%
# filter(Importance > 1.96 & OddsRatio < 100) %>%
filter(Importance > 1.96) %>%
ggplot(aes(x = OddsRatio, y = Variable, color = Direction)) +
geom_vline(xintercept = 1, linetype = "dashed", color = "gray") +
geom_segment(aes(x = 1, xend = OddsRatio, y = Variable, yend = Variable), linewidth = 1) +
geom_point(size = 4) +
scale_color_manual(values = c("Hotspot" = "#E41A1C", "Non-Hotspot" = "#377EB8")) +
theme_minimal(base_family = "PingFang TC") +
labs(title = "Odds Ratio",
x = "Odds Ratio",
y = "Variables")
imp_df %>%
filter(Importance > 1.96) %>%
ggplot(aes(x = Importance, y = Variable, color = Direction)) +
geom_segment(aes(x = 0, xend = Importance, y = Variable, yend = Variable), linewidth = 1) +
geom_point(size = 4) +
# 設定顏色：紅色為熱點，藍色為非熱點
scale_color_manual(values = c("Hotspot" = "#E41A1C", "Non-Hotspot" = "#377EB8")) +
theme_minimal(base_family = "PingFang TC") +
labs(title = "Variable Importance",
x = "Variable Importance",
y = "Variables")
imp_df %>%
filter(Importance > 1.96 & OddsRatio < 100) %>%
# filter(Importance > 1.96) %>%
ggplot(aes(x = OddsRatio, y = Variable, color = Direction)) +
geom_vline(xintercept = 1, linetype = "dashed", color = "gray") +
geom_segment(aes(x = 1, xend = OddsRatio, y = Variable, yend = Variable), linewidth = 1) +
geom_point(size = 4) +
scale_color_manual(values = c("Hotspot" = "#E41A1C", "Non-Hotspot" = "#377EB8")) +
theme_minimal(base_family = "PingFang TC") +
labs(title = "Odds Ratio",
x = "Odds Ratio",
y = "Variables")
all_features
all_features%>%colnames()
all_features <- all_features%>%
mutate(
lr_feature = ifelse(
(
(
(`事故類型及型態大類別名稱_車與車` > 0)
) &
(
(`當事者區分-類別-大類別名稱-車種_人` > 0)
) &
(
(`cause-group_Unidentified` > 0)
)
),
1,
0
)
)
MapperPlotterV2(
Mapper,
# label = all_features$hotspot,
label = all_features$lr_feature,
data = filter_data,
avg=TRUE,
is_node_attribute = FALSE
)
top_betweenness
View(top_betweenness)
